<!doctype html>
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
	<link rel="stylesheet" href="../css/project_template.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<title>Benjamin London</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	<style>

		.board {
		width: 100%;
		max-width:450px;
		halign: center;
		}

		table {
		border: 1px black solid;
		border-collapse: collapse;
		width:100%;
		}

		td {
		border: 1px black solid;
		width: 11.11%;
		padding-bottom: 11.11%;
		overflow: hidden;
		text-align: center;
		}

		td div {
		position:absolute;
		width:11.11%;
		height:11.11%;
		max-width:50px;
		text-align:center;
		font-size:8vw;
		cursor:default;
		background-color: rgba(255,255,255,0);
		}

		.keypad .btn {
		min-width:40px;
		}

		.bottom-spacer-5 {
		margin-bottom: 5px;
		}

		 @media (min-width: 450px) {
		    td div{
			    font-size: 35px;
		    }
		 }

		 tr:nth-child(1) td {
		    border-top: 3px black solid;
		 }

		 tr:nth-child(3n) td {
		    border-bottom: 3px black solid;
		 }

		 td:nth-child(1) {
		    border-left: 3px black solid;
		 }

		 td:nth-child(3n) {
		    border-right: 3px black solid;
		 }

		 td:hover
		    {
			    background-color:#eeeeee;
		    }

		    td.given
		    {
			    background-color:#dddddd;
		    }

		    td.selected
		    {
			    background-color:#99ffff;
		    }

	</style>

	<script type="text/javascript" src="test.js"></script>
	<script type="text/javascript">


		// stores the puzzle instance
		var sudoku;

		// initialize a new game. this generates and loads a new puzzle and sets up the
		// user interface controls.
		function init() {
			sudoku = new Sudoku();

			if(document.all) {
				document.body.onkeydown = getKey;
			}
			else {
				document.documentElement.onkeydown = getKey;
			}

			newGame();

		}

		// start a new game. this resets the board and generates a new puzzle.
		function newGame() {
			unselectCell();

			// update the puzzle difficulty level based on the radio buttons.
			for(var i = 0; i < document.controls.level.length; i++)
			{
				if(document.controls.level[i].checked == true)
					sudoku.level = parseInt(document.controls.level[i].value);
			}

			sudoku.newGame();

			for(var i = 0; i < 9; i++) {
				for(var j = 0; j < 9; j++) {
					var cell = document.getElementById("x" + i + "_" + j);

					cell.onclick = selectCell;

					if(!cell.firstChild)
						cell.appendChild(document.createTextNode(""));

					if(sudoku.getVal(i, j) == 0){
						cell.firstChild.nodeValue = "";
						removeClass(cell, "given");
					}
					else {
						cell.firstChild.nodeValue = sudoku.getVal(i, j);
						addClass(cell, "given");
					}
				}
			}			
		}

		// solve the game and display the solution.
		function solve() {
			// sudoku.solveGame();

			const url = 'http://localhost:8080/test/'
			const data = JSON.stringify({"board":sudoku.matrix.join("")});

			(function ($) {
				$.ajax({
	        		url: '/test',
	        		type: 'POST',
	        		contentType: 'application/json',
	        		data: data,
	        		success: function(response){
	        			solved_puzzle = response.split``.map(x=>+x);
	        			console.log(solved_puzzle)
	        			sudoku.matrix = solved_puzzle;
	        			for(var i = 0; i < 9; i++) {
	        				for(var j = 0; j < 9; j++) {
	        					var cell = document.getElementById("x" + i + "_" + j);
	        					cell.firstChild.nodeValue = sudoku.getVal(i, j);

	        				}
	        			}
	        		}
	        	})
			})(jQuery);
			
		}

		// stores the last cell clicked on by the user.
		var selectedCell;

		// selects the cell clicked on by the user.
		function selectCell()
		{
			unselectCell();

			selectedCell = this;
			addClass(selectedCell, "selected");
		}



		// unselects the selected cell. values entered are ignored until a cell is
		// selected again.
		function unselectCell()
		{
			if(selectedCell)
				removeClass(selectedCell, "selected");
			selectedCell = null;
		}

			// sets the value for the selected cell.
		function setVal(row, col, val)
			{
			// if there is no cell selected, ignore the input value.
			if(!selectedCell)
				return;

			// set the puzzle value and draw the value in the cell.
			sudoku.setVal(1 * row, 1 * col, val);
			selectedCell.firstChild.nodeValue = (val > 0) ? val : "";

		}

		// adds a css class to an html element.
		function addClass(el, name)
		{
			var arr;
			var parent = el.parentElement;
			var classes = parent.className;
			if(!classes)
				arr = new Array();
			else {
				classes = classes.trim();
				arr = classes.split(" ");
			}

			if(!arr.contains(name))
				arr.push(name);

			parent.className = arr.join(" ");
		}

		// removes a css class from an html element.
		function removeClass(el, name)
		{
			var arr;
			var parent = el.parentElement;
			var classes = parent.className;
			if(classes)
				arr = classes.split(" ");
			else
				arr = new Array();

			var arr2 = new Array();

			for(var i = 0; i < arr.length; i++)
			{
				if(arr[i] != name)
					arr2.push(arr[i]);
			}

			if(arr2.length > 0)
				parent.className = arr2.join(" ");
			else
				parent.className = "";
		}

		// determines whether or not an html element has the given class.
		function containsClass(el, name)
		{
			var parent = el.parentElement;
			var classes = parent.className;

			var arr;
			if(classes)
				arr = classes.split(" ");
			else
				arr = new Array();

			return arr.contains(name);
		}


		// gets the keyboard input.
		function getKey(e)
		{
			var id;
			var arr;
			if(selectedCell)
			{
				id = selectedCell.id;
				id = id.substr(1);
				arr = id.split("_");
			}

			if(document.all)
				e = event;

			if(e.keyCode)
				code = e.keyCode;
			else if(e.which)
				code = e.which;

			switch(code)
			{
				case 8: // backspace
				case 46: // delete
					if(arr)
						setVal(arr[0], arr[1], 0);
						removeClass(selectedCell,"given")
					return false;
					break;
				case 27: // escape
					unselectCell();
					break;
				default:
					if(arr)
					{
						if(code >= 49 && code <= 57) {				
							setVal(arr[0], arr[1], code - 48);
							addClass(selectedCell,"given")
						}		
						else if(code >= 97 && code <= 105) {
							setVal(arr[0], arr[1], code - 96);
							addClass(selectedCell,"given")
						}
					}
					break;
			}
		}	


</script>

</head>
<body onload="init();">
<div class="container">
	<div class="row" style="margin-top:10px;">
		<div class="col-sm-8">
			<div class="row">
				<div class="col-md-12">
				<form name="controls">
				<input id="easy" type="radio" name="level" checked="true" value="0"><label for="easy">Easy</label>
				<input id="medium" type="radio" name="level" value="1"><label for="medium">Medium</label>
				<input id="hard" type="radio" name="level" value="2"><label for="hard">Hard</label>
				<input id="manual" type="radio" name="level" value="3"><label for="manual">Manual</label>
				</form>
				</div>
			</div>
			<input id="new" class="btn btn-default" type="button" value="New Game" onclick="newGame();">
			<input class="btn btn-default" type="button" value="Solve It" onclick="solve();">
			<div class="row bottom-spacer-5">
				<div class="col-md-12">
				<div class="board center-block">
				<table>
					<tr>
						<td><div id="x0_0"></div></td>
						<td><div id="x0_1"></div></td>
						<td><div id="x0_2"></div></td>
						<td><div id="x0_3"></div></td>
						<td><div id="x0_4"></div></td>
						<td><div id="x0_5"></div></td>
						<td><div id="x0_6"></div></td>
						<td><div id="x0_7"></div></td>
						<td><div id="x0_8"></div></td>
					</tr>
					<tr>
						<td><div id="x1_0"></div></td>
						<td><div id="x1_1"></div></td>
						<td><div id="x1_2"></div></td>
						<td><div id="x1_3"></div></td>
						<td><div id="x1_4"></div></td>
						<td><div id="x1_5"></div></td>
						<td><div id="x1_6"></div></td>
						<td><div id="x1_7"></div></td>
						<td><div id="x1_8"></div></td>
					</tr>
					<tr>
						<td><div id="x2_0"></div></td>
						<td><div id="x2_1"></div></td>
						<td><div id="x2_2"></div></td>
						<td><div id="x2_3"></div></td>
						<td><div id="x2_4"></div></td>
						<td><div id="x2_5"></div></td>
						<td><div id="x2_6"></div></td>
						<td><div id="x2_7"></div></td>
						<td><div id="x2_8"></div></td>
					</tr>
					<tr>
						<td><div id="x3_0"></div></td>
						<td><div id="x3_1"></div></td>
						<td><div id="x3_2"></div></td>
						<td><div id="x3_3"></div></td>
						<td><div id="x3_4"></div></td>
						<td><div id="x3_5"></div></td>
						<td><div id="x3_6"></div></td>
						<td><div id="x3_7"></div></td>
						<td><div id="x3_8"></div></td>
					</tr>
					<tr>
						<td><div id="x4_0"></div></td>
						<td><div id="x4_1"></div></td>
						<td><div id="x4_2"></div></td>
						<td><div id="x4_3"></div></td>
						<td><div id="x4_4"></div></td>
						<td><div id="x4_5"></div></td>
						<td><div id="x4_6"></div></td>
						<td><div id="x4_7"></div></td>
						<td><div id="x4_8"></div></td>
					</tr>
					<tr>
						<td><div id="x5_0"></div></td>
						<td><div id="x5_1"></div></td>
						<td><div id="x5_2"></div></td>
						<td><div id="x5_3"></div></td>
						<td><div id="x5_4"></div></td>
						<td><div id="x5_5"></div></td>
						<td><div id="x5_6"></div></td>
						<td><div id="x5_7"></div></td>
						<td><div id="x5_8"></div></td>
					</tr>
					<tr>
						<td><div id="x6_0"></div></td>
						<td><div id="x6_1"></div></td>
						<td><div id="x6_2"></div></td>
						<td><div id="x6_3"></div></td>
						<td><div id="x6_4"></div></td>
						<td><div id="x6_5"></div></td>
						<td><div id="x6_6"></div></td>
						<td><div id="x6_7"></div></td>
						<td><div id="x6_8"></div></td>
					</tr>
					<tr>
						<td><div id="x7_0"></div></td>
						<td><div id="x7_1"></div></td>
						<td><div id="x7_2"></div></td>
						<td><div id="x7_3"></div></td>
						<td><div id="x7_4"></div></td>
						<td><div id="x7_5"></div></td>
						<td><div id="x7_6"></div></td>
						<td><div id="x7_7"></div></td>
						<td><div id="x7_8"></div></td>
					</tr>
					<tr>
						<td><div id="x8_0"></div></td>
						<td><div id="x8_1"></div></td>
						<td><div id="x8_2"></div></td>
						<td><div id="x8_3"></div></td>
						<td><div id="x8_4"></div></td>
						<td><div id="x8_5"></div></td>
						<td><div id="x8_6"></div></td>
						<td><div id="x8_7"></div></td>
						<td><div id="x8_8"></div></td>
					</tr>
				</table>
				</div>
				</div>
			</div>
		</div>
	</body>


